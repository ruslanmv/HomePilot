<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 400" fill="none">
  <defs>
    <style>
      @keyframes orbit { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }
      @keyframes pulse-in { 0%,100%{opacity:0.5;transform:scale(0.95)} 50%{opacity:1;transform:scale(1)} }
      @keyframes data-flow { 0%{stroke-dashoffset:20} 100%{stroke-dashoffset:0} }
      @keyframes fade-cycle { 0%,20%{opacity:0.3} 10%{opacity:1} }
      .orbit-ring { animation: orbit 12s linear infinite; transform-origin: 450px 200px; }
      .pulse-box { animation: pulse-in 3s ease-in-out infinite; }
      .data-line { stroke-dasharray: 10 10; animation: data-flow 1.5s linear infinite; }
      .fade-1 { animation: fade-cycle 5s ease-in-out infinite; }
      .fade-2 { animation: fade-cycle 5s ease-in-out 1s infinite; }
      .fade-3 { animation: fade-cycle 5s ease-in-out 2s infinite; }
      .fade-4 { animation: fade-cycle 5s ease-in-out 3s infinite; }
      .fade-5 { animation: fade-cycle 5s ease-in-out 4s infinite; }
    </style>
    <linearGradient id="cp-bg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0f0f23"/><stop offset="100%" style="stop-color:#1a1a3e"/>
    </linearGradient>
    <radialGradient id="cp-center" cx="50%" cy="50%" r="50%">
      <stop offset="0%" style="stop-color:#06b6d4;stop-opacity:0.3"/>
      <stop offset="100%" style="stop-color:#06b6d4;stop-opacity:0"/>
    </radialGradient>
    <filter id="cp-glow"><feGaussianBlur stdDeviation="6" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
    <clipPath id="cp-clip"><rect width="900" height="400" rx="16"/></clipPath>
  </defs>

  <g clip-path="url(#cp-clip)">
    <rect width="900" height="400" fill="url(#cp-bg)" rx="16"/>

    <!-- Title -->
    <text x="450" y="32" font-family="system-ui,-apple-system,'Segoe UI',Helvetica,Arial,sans-serif" font-size="13" font-weight="700" fill="#94a3b8" letter-spacing="3" text-anchor="middle">KNOWLEDGE COMPANION PIPELINE</text>
    <text x="450" y="50" font-family="system-ui,sans-serif" font-size="11" fill="#64748b" text-anchor="middle">How a single message flows through all context layers in Topology 4</text>

    <!-- Center hub: Agent -->
    <circle cx="450" cy="210" r="80" fill="url(#cp-center)"/>
    <circle cx="450" cy="210" r="52" fill="#0c4a6e" stroke="#06b6d4" stroke-width="2" opacity="0.9"/>
    <text x="450" y="204" font-family="system-ui,sans-serif" font-size="13" font-weight="700" fill="#e0f2fe" text-anchor="middle">Agent</text>
    <text x="450" y="222" font-family="system-ui,sans-serif" font-size="10" fill="#7dd3fc" text-anchor="middle">LLM + Tools</text>

    <!-- Orbiting ring (subtle) -->
    <g class="orbit-ring" opacity="0.15">
      <circle cx="450" cy="210" r="75" fill="none" stroke="#22d3ee" stroke-width="1" stroke-dasharray="4 8"/>
    </g>

    <!-- Left side: User Input -->
    <g transform="translate(60,170)">
      <rect x="0" y="0" width="130" height="80" rx="10" fill="#1e293b" stroke="#3b82f6" stroke-width="1.5" opacity="0.7" class="pulse-box"/>
      <text x="65" y="28" font-family="system-ui,sans-serif" font-size="11" font-weight="600" fill="#93c5fd" text-anchor="middle">User Message</text>
      <text x="65" y="44" font-family="system-ui,sans-serif" font-size="9" fill="#64748b" text-anchor="middle">text, images,</text>
      <text x="65" y="56" font-family="system-ui,sans-serif" font-size="9" fill="#64748b" text-anchor="middle">voice, documents</text>
    </g>
    <!-- Arrow: User → Agent -->
    <line x1="198" y1="210" x2="390" y2="210" stroke="#3b82f6" stroke-width="1.5" class="data-line"/>
    <polygon points="390,205 400,210 390,215" fill="#3b82f6" opacity="0.8"/>

    <!-- Right side: Response -->
    <g transform="translate(710,170)">
      <rect x="0" y="0" width="130" height="80" rx="10" fill="#1e293b" stroke="#10b981" stroke-width="1.5" opacity="0.7" class="pulse-box"/>
      <text x="65" y="28" font-family="system-ui,sans-serif" font-size="11" font-weight="600" fill="#6ee7b7" text-anchor="middle">Response</text>
      <text x="65" y="44" font-family="system-ui,sans-serif" font-size="9" fill="#64748b" text-anchor="middle">grounded, contextual,</text>
      <text x="65" y="56" font-family="system-ui,sans-serif" font-size="9" fill="#64748b" text-anchor="middle">personalized</text>
    </g>
    <!-- Arrow: Agent → Response -->
    <line x1="510" y1="210" x2="702" y2="210" stroke="#10b981" stroke-width="1.5" class="data-line"/>
    <polygon points="702,205 712,210 702,215" fill="#10b981" opacity="0.8"/>

    <!-- Top context layers -->
    <!-- User Profile -->
    <g transform="translate(240,68)" class="fade-1">
      <rect x="0" y="0" width="100" height="44" rx="8" fill="#1e293b" stroke="#f59e0b" stroke-width="1" opacity="0.7"/>
      <text x="50" y="18" font-family="system-ui,sans-serif" font-size="10" font-weight="600" fill="#fcd34d" text-anchor="middle">User Profile</text>
      <text x="50" y="32" font-family="system-ui,sans-serif" font-size="8" fill="#64748b" text-anchor="middle">name, preferences</text>
    </g>
    <line x1="290" y1="112" x2="430" y2="165" stroke="#f59e0b" stroke-width="1" opacity="0.3"/>

    <!-- Session Context -->
    <g transform="translate(370,68)" class="fade-2">
      <rect x="0" y="0" width="110" height="44" rx="8" fill="#1e293b" stroke="#8b5cf6" stroke-width="1" opacity="0.7"/>
      <text x="55" y="18" font-family="system-ui,sans-serif" font-size="10" font-weight="600" fill="#c4b5fd" text-anchor="middle">Session History</text>
      <text x="55" y="32" font-family="system-ui,sans-serif" font-size="8" fill="#64748b" text-anchor="middle">continuity across chats</text>
    </g>
    <line x1="425" y1="112" x2="450" y2="158" stroke="#8b5cf6" stroke-width="1" opacity="0.3"/>

    <!-- Persona Memory -->
    <g transform="translate(510,68)" class="fade-3">
      <rect x="0" y="0" width="120" height="44" rx="8" fill="#1e293b" stroke="#06b6d4" stroke-width="1" opacity="0.7"/>
      <text x="60" y="18" font-family="system-ui,sans-serif" font-size="10" font-weight="600" fill="#67e8f9" text-anchor="middle">Persona Memory</text>
      <text x="60" y="32" font-family="system-ui,sans-serif" font-size="8" fill="#64748b" text-anchor="middle">long-term, adaptive</text>
    </g>
    <line x1="570" y1="112" x2="475" y2="165" stroke="#06b6d4" stroke-width="1" opacity="0.3"/>

    <!-- Bottom context layers -->
    <!-- Knowledge RAG -->
    <g transform="translate(230,310)" class="fade-4">
      <rect x="0" y="0" width="120" height="44" rx="8" fill="#1e293b" stroke="#8b5cf6" stroke-width="1" opacity="0.7"/>
      <text x="60" y="18" font-family="system-ui,sans-serif" font-size="10" font-weight="600" fill="#c4b5fd" text-anchor="middle">Knowledge RAG</text>
      <text x="60" y="32" font-family="system-ui,sans-serif" font-size="8" fill="#64748b" text-anchor="middle">docs, PDFs, images</text>
    </g>
    <line x1="290" y1="310" x2="430" y2="260" stroke="#8b5cf6" stroke-width="1" opacity="0.3"/>

    <!-- Vision -->
    <g transform="translate(390,330)" class="fade-5">
      <rect x="0" y="0" width="80" height="44" rx="8" fill="#1e293b" stroke="#ec4899" stroke-width="1" opacity="0.7"/>
      <text x="40" y="18" font-family="system-ui,sans-serif" font-size="10" font-weight="600" fill="#f9a8d4" text-anchor="middle">Vision</text>
      <text x="40" y="32" font-family="system-ui,sans-serif" font-size="8" fill="#64748b" text-anchor="middle">image analysis</text>
    </g>
    <line x1="430" y1="330" x2="450" y2="265" stroke="#ec4899" stroke-width="1" opacity="0.3"/>

    <!-- Web Search -->
    <g transform="translate(510,310)" class="fade-1">
      <rect x="0" y="0" width="110" height="44" rx="8" fill="#1e293b" stroke="#10b981" stroke-width="1" opacity="0.7"/>
      <text x="55" y="18" font-family="system-ui,sans-serif" font-size="10" font-weight="600" fill="#6ee7b7" text-anchor="middle">Web Search</text>
      <text x="55" y="32" font-family="system-ui,sans-serif" font-size="8" fill="#64748b" text-anchor="middle">real-time info</text>
    </g>
    <line x1="565" y1="310" x2="475" y2="260" stroke="#10b981" stroke-width="1" opacity="0.3"/>

    <!-- Bottom tagline -->
    <text x="450" y="388" font-family="system-ui,sans-serif" font-size="10" fill="#475569" text-anchor="middle">Every context layer is optional and non-blocking — graceful degradation by design</text>
  </g>
</svg>
